{% extends "/shared/modal-list-layout.html" %}


{% block HEADERTAGS %}
{{ super() }} 
<style>
  .mui-panel {
    max-width: 500px;
  }
</style>
{% endblock %}

{% block LISTNAVBAR %}
  <nav id="appbar" class="mui-container-fluid mui-appbar mui--bg-primary">
  <table width="100%" cellspacing="0">
    <tr class="mui--appbar-height">
      <td>
        <a id="appbar-more-vert" href="{{ url_for('sites.home') }}" class="sidedrawer-toggle mui--visible-xs-inline-block mui--visible-sm-inline-block">
            <i class="material-icons mui--text-title">arrow_back</i>
        </a>
        <a id="appbar-more-vert" href="{{ url_for('sites.home') }}" class="sidedrawer-toggle mui--hidden-xs mui--hidden-sm">
            <i class="material-icons mui--text-title">arrow_back</i>
        </a>
        <span class="mui--text-title">New Site</span>
      </td>
    </tr>
  </table>
</nav>
{% endblock %}

{% block BODY %}
<div class="mui-panel">
  <form method="post" action="{{ url_for('sites.new', **request.args) }}" role="form">
    <legend>Create a new site</legend>
    {{ form.csrf_token }} 
    <div class="mui-textfield">
      {{ form.sitedescription(placeholder=form.sitedescription.description,
                    autofocus="true") }} 
      <label>{{ form.sitedescription.label.text }}</label>
      {% if form.sitedescription.errors -%}
        <div class="mui--text-danger">{{ form.sitedescription.errors[0] }}</div>
      {%- endif %}
    </div>
    <div class="mui-select">
      {{ form.runtime(placeholder=form.runtime.description, spellcheck="false", onchange="javascript: chgTypes(this.options[this.selectedIndex].value);") }}
      <label>{{ form.runtime.label.text }}</label>
      {% if form.runtime.errors -%}
      <div class="mui--text-danger">{{ form.runtime.errors[0] }}</div>
      {%- endif %}
    </div>
    <div class="mui-select">
      {{ form.sitetype(placeholder=form.sitetype.description, spellcheck="false") }}
      <label>{{ form.sitetype.label.text }}</label>
      {% if form.sitetype.errors -%}
        <div class="mui--text-danger">{{ form.sitetype.errors[0] }}</div>
      {%- endif %}
    </div>
    <button type="submit" class="mui-btn mui-btn--primary">Create site</button>
  </form>
</div>
{% endblock %}

{% block FOOTERTAGS %}
{{ h.javascript_tag(h.static('daspanel-rest-api-jquery.js')) }}

<!-- https://stackoverflow.com/questions/23712930/dynamically-update-selectfield-based-on-another-selectfields-data 
https://stackoverflow.com/questions/41232105/populate-wtforms-select-field-using-value-selected-from-previous-field
http://www.jyotiranjan.in/blog/create-dynamic-drop-down-list/

$.each(data, function() {
                    options.append($("<option />").val(this).text(this));
                })

$.each(data, function(i, row) {
  console.log(row.gender_name.S, row.gender_id.S)
})
-->
<script language="javascript" type="text/javascript">

    function chgTypes(listindex) {

        var site_types = null;

        site_types = restjQuery({
            endpoint: "_get_config/engines?q=" + listindex
        });

        if ( site_types !== undefined && site_types.length > 0 ) {
            console.log('Site Types: ' + site_types);
        } else {
            alert('Engine not found: ' + listindex);
        }
        return true;
    };

</script>
{% endblock %}

